---
title: "k8s cli"
date: 2025-08-26 20:00:00 +0900
categories: [blog]
layout: single
---


eval $(minikube -p minikube docker-env)

- **현재 로컬 Docker CLI가 바라보는 Docker 데몬을 로컬(Docker Desktop)이 아닌 Minikube 내부 Docker 데몬으로 변경 ⇒** 이후의 `docker` 명령은 **Minikube 내부에서 수행**

**context**

- 쿠버네티스가 어떤 클러스터에 접속할지 결정하는 설정
- 명령실행 전 항상 확인해서 context 전환을 잊지 말자…

```bash
# 현재 사용중인 context 확인
kubectl config current-context

# context 목록 확인
kubectl config get-contexts

# 스위칭
kubectl config use-context {name}
```
<br>

**Name Space**
```bash
# 현재 클러스터에 있는 namespace 목록 확인
kubectl get namespaces

# 특정 namespace의 pod 확인
kubectl get pods -n {namepace}

# 새로운 namespace 생성
kubectl create namespace {namespace}
```
<br>

**Service**

```bash
# Deployment나 Pod을 대상으로 Service를 자동 생성
kubectl expose deployment {name} --type=LoadBalancer --port=80
```

- {name}을 대상으로 Service를 생성. deployment가 대상인 경우, 해당 deployment에 연결된 모든 pod에도 service가 생성됨
- 클라이언트는 이제 Pod의 변하는 IP 대신 **Service의 고정 IP** 또는 로드밸런서를 통해 접속 가능
- `type=LoadBalancer`로 지정하면 **외부에서도 접근 가능**한 엔드포인트가 만들어짐 (클라우드 환경에서 실제 L4/L7 로드밸런서 생성)

```bash
# 서비스 확인
kubectl get svc
kubectl get service

NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP      10.96.0.1        <none>        443/TCP        3d5h
my-app       LoadBalancer   10.110.125.135   <pending>     80:32379/TCP   120m
```

<br>

**Deployment, Pods**
```bash
# 네임스페이스별 목록
kubectl get deploy -n {namespace}
kubectl get pods   -n {namespace}
kubectl get deploy,pods -n {namespace}     # 두 리소스 한 번에
kubectl get pods -A                # 모든 네임스페이스
kubectl get pods -o wide -n {namespace}    # 노드/IP 등 상세
kubectl get pods -l app=myapp -n {namespace}  # 라벨로 필터
```

pod 생성 규칙
Deployment가 만든 Pod 이름 => `dev-7c6d9b6b87-4t2qn`
* dev = deployment 이름
* 7c6d9b6b87 = ReplicaSet 해시
* 4t2qn = 무작위 접미사(각 파드 고유)

<br>

**업데이트 진행상황 보기**
```bash
# 업데이트 진행 상황 보기
kubectl describe deployment my-app

# 이미지 버전 업데이트
kubectl set image deployment/my-app my-app-container=nginx:1.25

# 롤아웃/버전 관리
kubectl rollout status deploy/myapp -n dev
kubectl rollout history deploy/myapp -n dev
kubectl rollout undo deployment {deployment} # 롤백 
kubectl rollout restart deploy/myapp -n dev
```


