---
title: "k8s"
date: 2025-08-26 12:00:00 +0900
categories: [blog]
layout: single
---

### 개념

- 컨테이너 조율 도구
- 여러개의 컨테이너를 효율적으로 배치, 관리, 확장, 복구
- 핵심 역할 ⇒ 배포, 스케일링, 자기치유, 로드밸런싱, 롤린 업데이트 , 자원최적화

<br>

### 기본 구성요소

**Control Plane → 관리자 역할, 총괄 관리**

- API Server : 모든 명령이 오가는 통신 허브(kubectl 등)
- etcd : 클러스터의 모든 설정 및 상태를 저장하는 Key-Value 저장소(DB역할)
- Scheduler : 새로 생성된 컨테이너를 어느 노드에 배치할지 결정
- Controller manager : Pod 상태를 지속적으로 확인하고, 문제가 생기는 경우 자동복구

**Node → 작업자 역할, 컨테이너(Pod)를 실행하는 서버**

- kulet : Node에서 Pod을 생성/삭제하고 상태를 보고하는 관리자
- Kube-proxy : 네트워크 및 로드밸런싱 담당
- Container Runtime : 실제 컨테이너를 실행하는 엔진(Docker, containerd 등등)

<br>

### 기본 단위

**pod** 

가장 작은 배포 단위. 하나의 컨테이너가 같은 네트워크, 같은 스토리지를 공유. 보통 1Pod = 1컨테이너

**Deployment**

Pod을 여러 개 복제하고, 버전을 관리하는 상위개념

**Service**

Pod은 언제든 재생성되므로 ip가 변경되는데, service는 고정된 엔드포인트를 제공해 Pod을 안정적으로 접근 가능하게 하고, 팟이 여러 개일 때 로드밸런서 역할도 수행

**ConfigMap / Secret**

설정값, 환경 변수 등을 Pod에 전달. ecret은 민감정보(DB 비밀번호 등)를 안전하게 관리

**Namespace**

클러스터 내 리소스들을 논리적으로 구분 (개발용, 운영용 분리 가능)
- 기본 제공 namespace
    - default → 별도 지정 안 하면 여기에 리소스가 생성됨
    - kube-system → 쿠버네티스 시스템 컴포넌트(CoreDNS, kube-proxy 등)
    - kube-public → 공개적으로 접근 가능한 리소스(거의 안 씀)
    - kube-node-lease → 노드 heartbeat 관리용


<br>

### Label
리소스에 붙이는 key=value 메타데이터(Pod, Service, Deployment, Node 등 거의 전부에 붙일 수 있음)

* 그룹핑 & 선택(Selector): Service가 selector로 라벨을 보고 어떤 Pod들에 트래픽을 보낼지 결정
* 배포/운영 편의:환경/버전/팀 등으로 묶어 조회·롤아웃·오토스케일링에 활용.
(추후 추가)

<br>

#### Version
Deployment는 Pod 템플릿이 바뀔 때마다 새 ReplicaSet을 만들고, 이를 revision(버전) 으로 관리

버전은 보통 컨테이너 이미지 태그(예: myrepo/myapp:1.2.3)를 의미하고 Deployment 관점의 “버전”은 revision 번호(1, 2, 3…)로 추적


<br>

### 동작흐름

1. kubectl apply -f deployment.yaml ⇒ 배포실행
2. API Server가 명령을 받고 **etcd**에 저장
3. Scheduler가 "어느 Node에서 Pod을 실행할지" 결정
4. 해당 Node의 **kubelet**이 Pod 생성 요청을 받아 컨테이너 실행
5. Pod이 죽으면 Controller가 감지 후 자동 재시작

<br>

### 쿠버네티스를 쓰는 이유
✔ 운영 자동화 (자동 복구, 자동 스케일링) 

✔ 서비스 무중단 배포

✔ 멀티 클라우드 및 온프레미스 환경에서 일관된 운영

✔ 대규모 마이크로서비스 아키텍처(MSA)에서 필수
